# 设计文档

本目录包含 DPML (Deepractice Prompt Markup Language) 的架构决策记录 (ADR)。

## 什么是 ADR？

ADR（Architecture Decision Record）是一种轻量级文档，用于记录重要的架构决策。每个 ADR 描述一个具体的决策，包括背景、决策本身及其后果。

## 文档索引

| ADR                                            | 标题         | 状态     | 日期    |
| ---------------------------------------------- | ------------ | -------- | ------- |
| [ADR-001](./adr-001-markup-language.md)        | 标记语言选择 | Accepted | 2025-01 |
| [ADR-002](./adr-002-three-party-model.md)      | 三方协同模型 | Accepted | 2025-01 |
| [ADR-003](./adr-003-schema-validation.md)      | Schema 验证策略 | Accepted | 2025-01 |

## ADR 状态定义

- **Proposed**: 讨论中，尚未做出最终决策
- **Accepted**: 决策已确认，正在实施
- **Deprecated**: 决策已被新的 ADR 取代
- **Rejected**: 决策未被采纳

## 设计决策概览

### ADR-001: 标记语言选择

DPML 采用类 XML 标记语法而非 JSON/YAML，核心原因：

- **四维语义**：tag/attribute/content/structure 是同时服务人类、AI、计算机的必要且充分的最小集合
- **AI 原生理解**：大模型对类 XML 语法有强大的理解和生成能力
- **可视化友好**：DOM 树结构天然支持可视化渲染

### ADR-002: 三方协同模型

DPML 基于"三方定位理论"设计：

- **人类**：创新意图 - 唯一能主动发起实践并产生真正创新的角色
- **AI**：语义转译 - 唯一能同时理解自然语言和高速处理的角色
- **计算机**：精确执行 - 唯一能以超高速度和绝对精确度执行指令的角色

通过四维语义框架，实现三方信息的统一载体和无损流转。

### ADR-003: Schema 验证策略

DPML 采用分层验证策略：

- **协议层**：只验证格式正确性（类 XML 语法）
- **领域层**：负责语义验证（元素约束、属性校验）
- **运行时**：根据六态流转位置，采用不同严格程度的验证

## 核心设计原则

### 1. 约而不束

提供结构和约定（约），但不限制 AI 的逻辑灵活性（不束）：

| 我们约束的         | 我们不束缚的           |
| ------------------ | ---------------------- |
| 语法：kebab-case   | 逻辑：content 中无控制流 |
| 结构：保留属性     | 表达：自然语言完全自由 |
| 概念：共识术语     | 行为：原则优于规则     |

### 2. 共识概念优先

使用广泛共识的术语（role、agent、task），而非自造概念：

- 共识概念是压缩的知识，AI 即时理解
- 自造词汇需要额外解释，消耗 Token

### 3. 双重语义

每个语法元素同时服务计算机语义和 AI 语义：

| 维度      | 计算机语义        | AI 语义         |
| --------- | ----------------- | --------------- |
| Tag       | 节点类型          | 概念定义        |
| Attribute | 键值对数据        | 可理解的配置    |
| Content   | 文本数据          | 自然语言空间    |
| Structure | DOM 树路径        | 上下文层级关系  |

## 相关资源

- [白皮书](/specs/v1.0/zh/whitepaper/index.md) - DPML 设计理念完整阐述
- [协议规范](/specs/v1.0/zh/protocol/index.md) - 技术规范文档
- [README](/README.md) - 项目概览
