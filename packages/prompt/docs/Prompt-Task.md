# DPML Prompt 开发任务清单 (TDD)

本文档列出了 `@dpml/prompt` 包的开发任务，按照测试驱动开发(TDD)原则排序。每个任务前的复选框用于标记完成状态。

## 1. 项目准备与测试环境搭建, 参照 core 包的开发模式

- [ ] 创建项目基础目录结构
- [ ] 配置测试环境和工具（Jest/Vitest）
- [ ] 编写测试辅助函数和工具类
- [ ] 创建基础测试框架文件

## 2. 标签定义与注册测试

- [ ] 编写基础标签注册测试用例 (UT-P-001)
- [ ] 实现八个核心标签的基础定义和注册功能
- [ ] 编写标签属性验证测试 (UT-P-002)
- [ ] 实现标签属性验证机制
- [ ] 编写标签嵌套规则测试 (UT-P-003)
- [ ] 实现标签嵌套规则验证
- [ ] 编写标签ID唯一性测试 (UT-P-004)
- [ ] 实现标签ID唯一性验证
- [ ] 编写自定义验证规则测试 (UT-P-005)
- [ ] 实现自定义验证规则机制

## 3. PromptTagProcessor 实现

- [ ] 编写基本属性处理测试 (UT-PP-001)
- [ ] 编写语言属性处理测试 (UT-PP-002)
- [ ] 编写子标签收集测试 (UT-PP-003)
- [ ] 实现 PromptTagProcessor 基础功能
- [ ] 实现语言属性处理功能
- [ ] 实现子标签收集与验证功能

## 4. RoleTagProcessor 实现

- [ ] 编写基本角色处理测试 (UT-RP-001)
- [ ] 编写角色描述提取测试 (UT-RP-002)
- [ ] 实现 RoleTagProcessor 基础功能
- [ ] 实现角色描述文本提取功能

## 5. ContextTagProcessor 实现

- [ ] 编写基本上下文处理测试 (UT-CP-001)
- [ ] 编写上下文内容提取测试 (UT-CP-002)
- [ ] 实现 ContextTagProcessor 基础功能
- [ ] 实现上下文文本提取功能

## 6. ThinkingTagProcessor 实现

- [ ] 编写基本思维处理测试 (UT-TP-001)
- [ ] 编写思维内容提取测试 (UT-TP-002)
- [ ] 实现 ThinkingTagProcessor 基础功能
- [ ] 实现思维框架文本提取功能

## 7. ExecutingTagProcessor 实现

- [ ] 编写基本执行处理测试 (UT-EP-001)
- [ ] 编写执行内容提取测试 (UT-EP-002)
- [ ] 实现 ExecutingTagProcessor 基础功能
- [ ] 实现执行步骤文本提取功能

## 8. TestingTagProcessor 实现

- [ ] 编写基本测试处理测试 (UT-TTP-001)
- [ ] 编写测试内容提取测试 (UT-TTP-002)
- [ ] 实现 TestingTagProcessor 基础功能
- [ ] 实现质量检查文本提取功能

## 9. ProtocolTagProcessor 实现

- [ ] 编写基本协议处理测试 (UT-PRP-001)
- [ ] 编写协议内容提取测试 (UT-PRP-002)
- [ ] 实现 ProtocolTagProcessor 基础功能
- [ ] 实现交互协议文本提取功能

## 10. CustomTagProcessor 实现

- [ ] 编写基本自定义内容处理测试 (UT-CTP-001)
- [ ] 编写最小干预策略测试 (UT-CTP-002)
- [ ] 实现 CustomTagProcessor 基础功能
- [ ] 实现最小干预处理原则

## 11. 继承机制测试与实现

- [ ] 编写基本继承处理测试 (UT-I-001)
- [ ] 实现基本 extends 属性处理功能
- [ ] 编写属性合并规则测试 (UT-I-002)
- [ ] 实现属性合并逻辑
- [ ] 编写内容继承规则测试 (UT-I-003)
- [ ] 实现内容继承逻辑
- [ ] 编写元数据合并测试 (UT-I-004)
- [ ] 实现元数据合并逻辑
- [ ] 编写本地文件继承测试 (UT-I-005)
- [ ] 实现本地文件引用继承
- [ ] 编写远程文件继承测试 (UT-I-006)
- [ ] 实现远程文件引用继承
- [ ] 编写多级继承测试 (UT-I-007)
- [ ] 实现多级继承链
- [ ] 编写循环继承检测测试 (UT-I-008)
- [ ] 实现循环继承检测
- [ ] 编写不存在引用处理测试 (UT-I-009)
- [ ] 实现不存在引用的错误处理

## 12. 基础转换功能

- [x] 编写基本转换功能测试 (UT-PT-001)
- [x] 实现基本转换功能
- [x] 编写标签序列化测试 (UT-PT-002)
- [x] 实现各标签序列化成文本
- [x] 编写转换选项配置测试 (UT-PT-003)
- [x] 实现转换选项影响逻辑
- [x] 编写空值处理测试 (UT-PT-004)
- [x] 实现空标签和空内容处理
- [x] 编写Markdown转换测试 (UT-PT-005)
- [x] 实现Markdown内容转换

## 13. 格式配置功能

- [x] 编写默认格式应用测试 (UT-FC-001)
- [x] 实现默认格式模板
- [x] 编写自定义格式模板测试 (UT-FC-002)
- [x] 实现自定义格式覆盖逻辑
- [x] 编写标题前缀后缀测试 (UT-FC-003)
- [x] 实现标题、前缀、后缀应用
- [x] 编写内容包装器测试 (UT-FC-004)
- [x] 实现包装器函数处理
- [x] 编写标签顺序定制测试 (UT-FC-005)
- [x] 实现按指定顺序组织标签
- [x] 编写部分格式覆盖测试 (UT-FC-006)
- [x] 实现部分标签格式覆盖逻辑

## 14. 多语言支持功能

- [ ] 编写语言属性处理测试 (UT-ML-001)
- [ ] 实现lang属性影响输出的逻辑
- [ ] 编写语言指令添加测试 (UT-ML-002)
- [ ] 实现语言指令添加选项
- [ ] 编写语言特定格式测试 (UT-ML-003)
- [ ] 实现语言特定格式模板
- [ ] 编写中文特殊处理测试 (UT-ML-004)
- [ ] 实现中文格式规则
- [ ] 编写多语言混合内容测试 (UT-ML-005)
- [ ] 实现混合内容处理逻辑
- [ ] 编写API覆盖语言测试 (UT-ML-006)
- [ ] 实现API语言设置优先级

## 15. API功能实现

- [ ] 编写 generatePrompt 基本功能测试 (UT-API-001)
- [ ] 实现 generatePrompt 基本功能
- [ ] 编写配置选项传递测试 (UT-API-002)
- [ ] 实现配置选项传递逻辑
- [ ] 编写错误处理机制测试 (UT-API-003)
- [ ] 实现错误处理逻辑
- [ ] 编写仅验证模式测试 (UT-API-004)
- [ ] 实现 validateOnly 选项
- [ ] 编写格式模板传递测试 (UT-API-005)
- [ ] 实现格式模板选项应用

## 16. processPrompt 和 transformPrompt 实现

- [ ] 编写 processPrompt 基本功能测试 (UT-PRP-001)
- [ ] 实现 processPrompt 基本功能
- [ ] 编写处理选项配置测试 (UT-PRP-002)
- [ ] 实现处理选项影响逻辑
- [ ] 编写严格模式切换测试 (UT-PRP-003)
- [ ] 实现严格模式和宽松模式
- [ ] 编写基础路径设置测试 (UT-PRP-004)
- [ ] 实现基础路径影响逻辑
- [ ] 编写 transformPrompt 基本功能测试 (UT-TRP-001)
- [ ] 实现 transformPrompt 基本功能
- [ ] 编写转换选项配置测试 (UT-TRP-002)
- [ ] 实现转换选项影响逻辑
- [ ] 编写标签格式化测试 (UT-TRP-003)
- [ ] 实现标签格式化选项
- [ ] 编写输出一致性测试 (UT-TRP-004)
- [ ] 实现多次转换结果一致性保证

## 17. 错误处理实现

- [ ] 编写解析错误处理测试 (UT-ERR-001)
- [ ] 实现DPML语法错误处理
- [ ] 编写验证错误处理测试 (UT-ERR-002)
- [ ] 实现标签验证错误处理
- [ ] 编写处理错误处理测试 (UT-ERR-003)
- [ ] 实现处理过程错误处理
- [ ] 编写引用错误处理测试 (UT-ERR-004)
- [ ] 实现引用路径错误处理
- [ ] 编写转换错误处理测试 (UT-ERR-005)
- [ ] 实现转换阶段错误处理
- [ ] 编写未知错误处理测试 (UT-ERR-006)
- [ ] 实现未分类错误处理
- [ ] 编写错误位置信息测试 (UT-ERR-007)
- [ ] 实现准确的错误位置信息

## 18. 集成测试

- [ ] 编写端到端基本流程测试 (IT-P-001)
- [ ] 编写与Core包集成测试 (IT-P-002)
- [ ] 编写复杂提示处理测试 (IT-P-003)
- [ ] 编写多文件继承测试 (IT-P-004)
- [ ] 编写文件系统集成测试 (IT-P-005)
- [ ] 编写网络资源集成测试 (IT-P-006)
- [ ] 编写大型提示处理测试 (IT-P-007)

## 19. 性能测试

- [ ] 编写基本性能测试 (PT-P-001)
- [ ] 编写大型文档性能测试 (PT-P-002)
- [ ] 编写复杂继承性能测试 (PT-P-003)
- [ ] 编写并发处理性能测试 (PT-P-004)
- [ ] 编写内存占用分析测试 (PT-P-005)

## 20. 实际用例测试

- [ ] 编写数据分析师提示测试 (UC-P-001)
- [ ] 编写编程助手提示测试 (UC-P-002)
- [ ] 编写金融顾问提示测试 (UC-P-003)
- [ ] 编写医疗咨询提示测试 (UC-P-004)
- [ ] 编写多语言提示测试 (UC-P-005)
- [ ] 编写继承复用提示测试 (UC-P-006)

## 21. 兼容性测试

- [ ] 编写Node.js版本兼容性测试 (CT-P-001)
- [ ] 编写浏览器兼容性测试 (CT-P-002)
- [ ] 编写Core包版本兼容性测试 (CT-P-003)
- [ ] 编写CommonJS/ESM兼容性测试 (CT-P-004)
- [ ] 编写TypeScript版本兼容性测试 (CT-P-005)

## 22. 文档和示例

- [ ] 完善API文档
- [ ] 创建使用示例
- [ ] 编写最佳实践指南
- [ ] 完善错误处理文档
- [ ] 创建演示案例 