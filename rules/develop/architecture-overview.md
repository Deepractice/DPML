# DPML 架构概览

## 1. 分层架构

DPML 项目采用严格的分层架构设计：

### 1.1 API 层
- 对外提供接口，是用户与系统交互的唯一入口
- 仅包含薄层委托，不包含业务逻辑
- 负责参数验证、错误转换和返回值封装

### 1.2 Types 层
- 定义所有类型和接口规范
- 仅包含类型定义，不包含实现逻辑
- 是跨层通信的契约

### 1.3 Core 层
- 包含核心业务逻辑和功能实现
- 下分为多个子层：
  - **模块服务层**: 协调各组件，提供服务
  - **执行组件层**: 实现具体功能
  - **状态管理层**: 管理状态和配置

## 2. 组件分类

### 2.1 执行组件
- 负责执行特定功能的组件
- 无状态或状态有限
- 例如：解析器、验证器、格式化器

### 2.2 状态管理组件
- 管理应用状态的组件
- 通常采用单例模式
- 例如：配置管理器、注册表

### 2.3 模块服务
- 协调多个组件工作的服务
- 为API层提供功能支持
- 管理组件生命周期

## 3. 数据流向

### 3.1 单向数据流
- 数据流向须遵循: API层 → Core层 → Types层
- 禁止逆向依赖
- 禁止跨层访问

### 3.2 层间通信
- 使用明确定义的接口通信
- 上层通过接口调用下层
- 下层通过返回值响应上层

## 4. 依赖注入

### 4.1 依赖注入原则
- 组件依赖应通过构造函数注入
- 避免直接实例化依赖
- 使用服务定位器或工厂模式创建实例

### 4.2 测试替身
- 设计时考虑依赖的可替换性
- 所有外部依赖应可被模拟
- 配置应可在测试中覆盖

## 5. 约束与规范

### 5.1 禁止事项
- 禁止越层调用
- 禁止循环依赖
- 禁止共享可变状态
- 禁止硬编码配置

### 5.2 必须遵循
- 必须遵循单一职责原则
- 必须编写测试覆盖功能点
- 必须处理所有可能的错误
- 必须使用类型系统保证类型安全 