# DPML 编码规范

## 1. TypeScript 规范

### 1.1 命名约定
- **接口**: 使用名词或名词短语，不使用"I"前缀
- **类**: 使用PascalCase，名词或名词短语
- **函数/方法**: 使用camelCase，动词或动词短语开头
- **变量/参数**: 使用camelCase，具有描述性
- **常量**: 使用UPPER_SNAKE_CASE
- **私有成员**: 使用下划线前缀（_privateVariable）

### 1.2 类型声明
- 总是声明函数参数和返回值的类型
- 避免使用`any`类型，优先使用`unknown`或具体类型
- 使用`readonly`标记不可变属性
- 使用类型别名简化复杂类型

### 1.3 注释规范
- 使用JSDoc格式为公共API添加注释
- 每个类型、接口、函数必须有描述其用途的注释
- 复杂逻辑必须有解释性注释
- 使用`@param`、`@returns`等标记注释参数和返回值

### 1.4 代码组织
- 每个文件应只导出一个主要组件
- 相关功能应组织在同一目录下
- 使用桶文件(index.ts)统一导出

## 2. 函数式编程规范

### 2.1 不可变性
- 优先使用不可变数据结构
- 避免修改函数参数
- 返回新对象而非修改现有对象

### 2.2 纯函数
- 尽可能编写无副作用的纯函数
- 将副作用隔离在特定的服务层
- 避免在函数内部修改全局状态

## 3. 错误处理

### 3.1 异常处理
- 明确区分预期错误和非预期错误
- 使用自定义Error类扩展错误信息
- 总是捕获并正确处理异步操作中的错误

### 3.2 错误传递
- 使用Result类型或类似模式传递错误信息
- 避免在深层嵌套中抛出异常
- 在边界处统一处理错误

## 4. 测试相关编码规范

### 4.1 可测试性
- 依赖注入而非硬编码依赖
- 函数职责单一，便于单元测试
- 避免全局状态，使用依赖注入

### 4.2 测试友好设计
- 公开接口应易于模拟(mock)和测试
- 避免测试代码中的重复逻辑
- 使用工厂函数创建测试数据 