# DPML 编码规范

## 1. 语言使用规范

### 1.1 代码语言
- **代码使用英文**：除了文档以外，没有特别说明的情况下，所有代码相关内容必须使用英文，包括：
  - 变量名、函数名、类名等标识符
  - 注释和文档字符串
  - 日志信息和错误消息
  - 代码中的字符串常量（非面向用户的内容）
- **命名应有意义**：使用清晰、描述性的英文名称
- **避免缩写**：除非是普遍接受的缩写（如URL、HTTP），否则避免使用缩写
- **日志内容**：所有日志内容必须使用英文，便于国际化协作和工具处理

## 2. TypeScript 规范

### 2.1 命名约定
- **接口**: 使用名词或名词短语，不使用"I"前缀
- **类**: 使用PascalCase，名词或名词短语
- **函数/方法**: 使用camelCase，动词或动词短语开头
- **变量/参数**: 使用camelCase，具有描述性
- **常量**: 使用UPPER_SNAKE_CASE
- **私有成员**: 使用下划线前缀（_privateVariable）

### 2.2 类型声明
- 总是声明函数参数和返回值的类型
- 避免使用`any`类型，优先使用`unknown`或具体类型
- 使用`readonly`标记不可变属性
- 使用类型别名简化复杂类型

### 2.3 注释规范
- 使用JSDoc格式为公共API添加注释
- 每个类型、接口、函数必须有描述其用途的注释
- 复杂逻辑必须有解释性注释
- 使用`@param`、`@returns`等标记注释参数和返回值

### 2.4 代码组织
- 每个文件应只导出一个主要组件
- 相关功能应组织在同一目录下
- 使用桶文件(index.ts)统一导出

## 3. 函数式编程规范

### 3.1 不可变性
- 优先使用不可变数据结构
- 避免修改函数参数
- 返回新对象而非修改现有对象

### 3.2 纯函数
- 尽可能编写无副作用的纯函数
- 将副作用隔离在特定的服务层
- 避免在函数内部修改全局状态

## 4. 错误处理

### 4.1 异常处理
- 明确区分预期错误和非预期错误
- 使用自定义Error类扩展错误信息
- 总是捕获并正确处理异步操作中的错误

### 4.2 错误传递
- 使用Result类型或类似模式传递错误信息
- 避免在深层嵌套中抛出异常
- 在边界处统一处理错误

## 5. 测试相关编码规范

### 5.1 可测试性
- 依赖注入而非硬编码依赖
- 函数职责单一，便于单元测试
- 避免全局状态，使用依赖注入

### 5.2 测试友好设计
- 公开接口应易于模拟(mock)和测试
- 避免测试代码中的重复逻辑
- 使用工厂函数创建测试数据 